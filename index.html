<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NYVYA IA Phone</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; background: #f6f8fb; }
    .container { max-width: 480px; margin: 0 auto; padding: 18px 0; }
    h1 { text-align: center; color: #222; margin-bottom: 0.2em; }
    .menu-block { background: #fff; border-radius: 18px; box-shadow: 0 2px 8px #0001; margin: 18px 0; padding: 20px 0 10px 0; }
    .menu-title { text-align: center; font-size: 1.45em; margin-bottom: 10px; color: #2177B6; font-weight: bold;}
    .sub-block { text-align: center; margin-bottom: 6px; }
    .menu-btn { display: block; width: 90%; margin: 10px auto; padding: 16px 8px; border: none; border-radius: 16px;
      background: #edf1fa; color: #1a2333; font-size: 1.18em; font-weight: 600; box-shadow: 0 1px 6px #0001;
      cursor: pointer; transition: 0.12s; }
    .menu-btn:hover { background: #e2ecfd; }
    .voice-choice { display: flex; justify-content: center; gap: 24px; margin-bottom: 12px; }
    .voice-btn { border: none; border-radius: 14px; padding: 13px 32px; font-size: 1.12em; font-weight: 500;
      background: #dde7fa; cursor: pointer; box-shadow: 0 1px 6px #0001; }
    .voice-btn.selected { background: #b9d3f7; color: #10305e; }
    .small { font-size: 0.99em; color: #3a5270; margin-bottom: 6px;}
    .modal { position: fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.18); display: flex; align-items:center; justify-content:center; z-index:100;}
    .modal-content { background:#fff; padding:28px; border-radius:15px; text-align:center; min-width:220px;}
    @media(max-width: 520px) {
      .container { padding: 0 3vw; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><span style="color:#13bb97">NYVYA IA Phone</span></h1>
    <div id="welcomeBlock" class="menu-block">
      <div class="menu-title" id="menuTitle">Bienvenue sur NYVYA IA !</div>
      <div class="small" id="voiceAsk">Veux-tu utiliser la <b>commande vocale</b> ou <b>√©crite</b>‚ÄØ?</div>
      <div class="voice-choice">
        <button id="btnVoice" class="voice-btn"><span>üé§</span> Mode vocal</button>
        <button id="btnText" class="voice-btn"><span>‚å®Ô∏è</span> Mode √©crit</button>
      </div>
    </div>

    <div id="mainMenu" class="menu-block" style="display:none">
      <div class="menu-title" style="color:#234;">Choisis une fonctionnalit√© :</div>
      <button class="menu-btn" onclick="go('assistant')">‚ú® Assistant personnalis√© / Packs Waouh</button>
      <button class="menu-btn" onclick="go('espace')">üë• Espace sp√©cialis√© : Parents, Nounous, Cr√®ches, Enfants, Pro</button>
      <button class="menu-btn" onclick="go('traduction')">üåç Traduction vocale bi-directionnelle</button>
      <button class="menu-btn" onclick="go('actus')">üì∞ R√©sum√© Actus 5-10min (tout sujet, tout pays)</button>
      <button class="menu-btn" onclick="go('histoire')">üìñ Histoire IA ultra-personnalis√©e</button>
      <button class="menu-btn" onclick="go('berceuse')">üé∂ Berceuse IA personnalis√©e</button>
      <button class="menu-btn" onclick="go('jeu')">üß© Jeu / Devinette IA</button>
      <button class="menu-btn" onclick="go('blague')">üòÇ Blague sur mesure IA</button>
    </div>
  </div>

  <div id="modal" class="modal" style="display:none"><div class="modal-content" id="modalContent"></div></div>

  <script>
    // === VARS & UTILS ===
    let mode = ""; // "vocal" ou "texte"
    let isListening = false;
    let recognition, synth = window.speechSynthesis;

    function speak(txt, cb) {
      if (!txt) return;
      let u = new SpeechSynthesisUtterance(txt);
      u.lang = "fr-FR";
      u.rate = 1;
      u.onend = function(){ if(cb) setTimeout(cb, 160); };
      synth.cancel(); synth.speak(u);
    }

    function askWelcome() {
      speak("Bienvenue sur NYVYA IA ! Veux-tu utiliser la commande vocale ou √©crite ?", () => listenWelcome());
    }

    // === Speech Recognition INIT ===
    function getRecognition() {
      if (!('webkitSpeechRecognition' in window)) return null;
      let rec = new webkitSpeechRecognition();
      rec.lang = "fr-FR";
      rec.interimResults = false;
      rec.maxAlternatives = 1;
      return rec;
    }

    function listenWelcome() {
      recognition = getRecognition();
      if (!recognition) return;
      isListening = true;
      recognition.start();
      recognition.onresult = (event) => {
        let res = event.results[0][0].transcript.toLowerCase();
        if (res.includes("vocal")) selectMode("vocal");
        else if (res.includes("√©crit") || res.includes("texte")) selectMode("texte");
        else speak("Je n'ai pas compris. Veux-tu utiliser la commande vocale ou √©crite ?", () => listenWelcome());
      };
      recognition.onerror = (e) => {
        isListening = false;
        speak("Je n'ai pas compris. Veux-tu utiliser la commande vocale ou √©crite ?", () => listenWelcome());
      };
    }

    // === Mode selection ===
    function selectMode(newMode) {
      mode = newMode;
      document.getElementById('welcomeBlock').style.display = "none";
      document.getElementById('mainMenu').style.display = "";
      if (mode === "vocal") {
        speak("Mode vocal activ√©. Dites le nom de la fonctionnalit√© souhait√©e.", listenMenu);
      }
    }
    document.getElementById('btnVoice').onclick = () => selectMode("vocal");
    document.getElementById('btnText').onclick = () => selectMode("texte");

    // === Main Menu - VOCAL ===
    function listenMenu() {
      recognition = getRecognition();
      if (!recognition) return;
      isListening = true;
      recognition.start();
      recognition.onresult = (event) => {
        let res = event.results[0][0].transcript.toLowerCase();
        // Mapping vocal to menu
        if (res.includes("assistant") || res.includes("pack")) go("assistant");
        else if (res.includes("espace") || res.includes("parent") || res.includes("nounou") || res.includes("cr√®che") || res.includes("enfant") || res.includes("pro")) go("espace");
        else if (res.includes("traduction") || res.includes("vocale")) go("traduction");
        else if (res.includes("actu") || res.includes("actualit√©") || res.includes("r√©sum√©")) go("actus");
        else if (res.includes("histoire")) go("histoire");
        else if (res.includes("berceuse") || res.includes("chanson")) go("berceuse");
        else if (res.includes("jeu") || res.includes("devinette")) go("jeu");
        else if (res.includes("blague")) go("blague");
        else if (res.includes("retour") || res.includes("menu")) { 
          document.getElementById('mainMenu').style.display = "";
          speak("De retour au menu. Dites le nom d'une fonctionnalit√©.", listenMenu);
        }
        else speak("Je n'ai pas compris. R√©p√©tez le nom de la fonctionnalit√© souhait√©e.", listenMenu);
      };
      recognition.onerror = (e) => {
        isListening = false;
        speak("Je n'ai pas compris. R√©p√©tez le nom de la fonctionnalit√© souhait√©e.", listenMenu);
      };
    }

    // === MENU NAV ===
    function go(type) {
      // Ici tu mets l'appel de chaque vraie fonctionnalit√© (ou affiche une modale temporaire)
      let titres = {
        "assistant": "Assistant personnalis√© √† int√©grer ici.",
        "espace": "Espace sp√©cialis√© √† int√©grer ici.",
        "traduction": "Traduction √† int√©grer ici.",
        "actus": "R√©sum√© d'actualit√©s √† int√©grer ici.",
        "histoire": "Histoire IA √† int√©grer ici.",
        "berceuse": "Berceuse IA √† int√©grer ici.",
        "jeu": "Jeu/Devinette IA √† int√©grer ici.",
        "blague": "Blague IA √† int√©grer ici."
      };
      showModal(titres[type]);
      // Pour le vocal, relance l'√©coute apr√®s fermeture du modal :
      if (mode === "vocal") setTimeout(listenMenu, 1300);
    }

    // === MODAL SIMPLE POUR TEST ===
    function showModal(msg) {
      let m = document.getElementById('modal');
      document.getElementById('modalContent').innerHTML = msg + "<br><br><button onclick='closeModal()' style='padding:10px 30px;font-size:1em;border-radius:12px;margin-top:8px'>Fermer</button>";
      m.style.display = "flex";
    }
    function closeModal() {
      document.getElementById('modal').style.display = "none";
    }

    // === AUTO INIT ===
    window.onload = () => {
      document.getElementById('welcomeBlock').style.display = "";
      document.getElementById('mainMenu').style.display = "none";
      setTimeout(() => { askWelcome(); }, 300);
    };
  </script>
</body>
</html>
