<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nyvya IA Phone</title>
  <meta name="theme-color" content="#FFFFFF" />
  <style>
    body { font-family: system-ui,sans-serif; padding: 1em; }
    button { 
      margin: 5px 0; padding: 0.45em 1em; font-size: 1.12em; 
      border-radius: 20px; border: none; background: #edf0fa; color: #114;
      cursor: pointer; transition: 0.1s; box-shadow: 1px 1px 4px #0001;
      display: inline-block;
    }
    button:hover { background: #d5e6fa; }
    #zone { margin-top: 1.4em; }
    .mic-btn { background: #cce8dc; color: #234; margin-left: 8px; }
    .mode-btn { background: #f3d7e6; color: #700; margin-left: 8px;}
    .formzone { background: #f8faff; padding: 1em; border-radius: 15px; margin-bottom: 15px;}
    input, textarea { font-size: 1em; padding: 5px 10px; border-radius: 8px; border: 1px solid #ccc; }
    label { font-weight: bold; }
    textarea { width: 95%; min-height: 40px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>Bienvenue sur Nyvya IA Phone !</h1>
  <div id="accueil"></div>
  <div id="zone"></div>

<script>
let modeVocal = false;
let recognition, recognizing = false;

// --- TTS navigateur, 100 % gratuit
function parlerTexte(text) {
  const synth = window.speechSynthesis;
  if (!text) return;
  synth.cancel(); // Stop toute voix précédente
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "fr-FR";
  synth.speak(utter);
}

// --- Reconnaissance vocale navigateur (Web Speech API)
function initReconnaissance() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) return;
  recognition = new SpeechRecognition();
  recognition.lang = 'fr-FR';
  recognition.interimResults = false;
  recognition.continuous = true;
  recognition.onresult = (event) => {
    const res = event.results[event.results.length-1][0].transcript.trim().toLowerCase();
    traiterCommande(res);
  };
  recognition.onerror = () => {};
  recognition.onend = () => { if (modeVocal) recognition.start(); };
}

// --- Gère le choix vocal/écrit à l'accueil
function accueilChoixMode() {
  let html = `
    <div class="formzone">
      <b>Bienvenue sur NYVYA IA !</b><br>
      Veux-tu utiliser la <b>commande vocale</b> ou <b>écrite</b> ?<br><br>
      <button onclick="choisirMode('vocal')">🎤 Mode vocal</button>
      <button onclick="choisirMode('ecrit')">⌨️ Mode écrit</button>
    </div>
  `;
  document.getElementById('accueil').innerHTML = html;
  parlerTexte("Bienvenue sur NYVYA IA. Veux-tu utiliser la commande vocale ou écrite ?");
  // Si micro ok, auto-écoute (après bouton micro navigateur)
  setTimeout(() => { if (modeVocal) startReco(); }, 600);
}

function choisirMode(mode) {
  modeVocal = (mode === 'vocal');
  document.getElementById('accueil').innerHTML = `
    <span style="font-size:1.1em;">
      Mode <b>${modeVocal ? 'vocal' : 'écrit'}</b> activé.
      <button class="mode-btn" onclick="accueilChoixMode()">Changer de mode</button>
    </span>
    ${modeVocal ? `<button class="mic-btn" onclick="startReco()">🎤 Relancer micro</button>` : ""}
  `;
  if (modeVocal) startReco();
  else stopReco();
  menu(""); // Affiche le menu principal
}

function startReco() {
  if (!recognition) initReconnaissance();
  if (recognition && !recognizing) {
    recognition.start();
    recognizing = true;
  }
}

function stopReco() {
  if (recognition && recognizing) {
    recognition.stop();
    recognizing = false;
  }
}

// Traite les commandes vocales générales
function traiterCommande(txt) {
  if (!txt) return;
  if (txt.includes("mode écrit")) { choisirMode('ecrit'); return; }
  if (txt.includes("mode vocal")) { choisirMode('vocal'); return; }
  if (txt.includes("retour")) { menu(""); return; }
  // Navigation menu principal par la voix
  if (txt.includes("histoire")) { menu("histoire"); return; }
  if (txt.includes("berceuse")) { menu("berceuse"); return; }
  if (txt.includes("blague")) { menu("blague"); return; }
  if (txt.includes("traduction")) { menu("traduction"); return; }
  if (txt.includes("actualité") || txt.includes("actu")) { menu("actu"); return; }
  if (txt.includes("jeu") || txt.includes("devinette")) { menu("jeu"); return; }
  if (txt.includes("assistant")) { menu("pack"); return; }
  // Générer dans les sous-menus
  if (txt.includes("génère") || txt.includes("générer") || txt.includes("valide")) {
    // Appelle le bon bouton (astuce : simule un clic si champ rempli)
    let btn = document.querySelector('#zone button[data-gen="1"]');
    if (btn) btn.click();
    return;
  }
  // Dictée dans les champs texte
  let input = document.querySelector("#zone input[type=text]");
  if (input && txt && input.value !== txt) input.value = txt;
}

// MENU PRINCIPAL & FONCTIONS
function menu(type) {
  let html = "";
  if (!type) {
    html = `
    <div class="formzone">
      <b>Choisis une fonctionnalité :</b><br>
      <button onclick="menu('pack')">✨ Assistant personnalisé / Packs Waouh</button>
      <button onclick="menu('special')">👨‍👩‍👧‍👦 Espace spécialisé : Parents, Nounous, Crèches, Enfants, Pro</button>
      <button onclick="menu('traduction')">🌍 Traduction vocale bi-directionnelle</button>
      <button onclick="menu('actu')">📰 Résumé Actus 5-10min (tout sujet, tout pays)</button>
      <button onclick="menu('histoire')">📖 Histoire IA ultra-personnalisée</button>
      <button onclick="menu('berceuse')">🎶 Berceuse IA personnalisée</button>
      <button onclick="menu('jeu')">🧩 Jeu / Devinette IA</button>
      <button onclick="menu('blague')">😂 Blague sur mesure IA</button>
    </div>
    `;
  }
  else if (type === "pack") {
    html = `<p>Assistant personnalisé et packs waouh : à venir…</p><button onclick="menu('')">⬅️ Retour</button>`;
  }
  else if (type === "special") {
    html = `
      <div class="formzone">
        <b>Espace spécialisé :</b><br>
        <button onclick="menu('parents')">👨‍👩‍👧 Parents</button>
        <button onclick="menu('nounous')">🧑‍🍼 Nounous</button>
        <button onclick="menu('creches')">🏫 Crèches</button>
        <button onclick="menu('enfants')">🧒 Enfants</button>
        <button onclick="menu('pro')">👨‍🏫 Pro / Éducateurs</button>
      </div>
      <button onclick="menu('')">⬅️ Retour</button>
    `;
  }
  else if (type === "parents" || type === "nounous" || type === "creches" || type === "enfants" || type === "pro") {
    html = `<p>Espace ${type} à venir…</p><button onclick="menu('special')">⬅️ Retour</button>`;
  }
  else if (type === "traduction") {
    html = `<p>Traduction vocale bi-directionnelle : à venir…</p><button onclick="menu('')">⬅️ Retour</button>`;
  }
  else if (type === "actu") {
    html = `<p>Résumé d’actualités 5/10min tous sujets/pays : à venir…</p><button onclick="menu('')">⬅️ Retour</button>`;
  }
  else if (type === "histoire") {
    html = `
      <div class="formzone">
        <h2>Histoire IA personnalisée</h2>
        <label>Pour qui ? (prénom, âge, envies, thème…)</label><br>
        <input id="cibleHistoire" style="width:85%;margin:10px 0" placeholder="ex: Wharys, 7 ans, aime les dragons" /><br>
        <button data-gen="1" onclick="genererTexteIA('histoire')">Générer l’histoire IA</button>
      </div>
      <div id="resultHistoire" style="margin-top:1.5em"></div>
      <button onclick="menu('')">⬅️ Retour</button>
    `;
  }
  else if (type === "berceuse") {
    html = `
      <div class="formzone">
        <h2>Berceuse IA personnalisée</h2>
        <label>Pour qui ? (prénom, âge, humeur, bruit de fond…)</label><br>
        <input id="cibleBerceuse" style="width:85%;margin:10px 0" placeholder="ex: Wharys, 7 ans, triste, bruit de pluie" /><br>
        <button data-gen="1" onclick="genererTexteIA('berceuse')">Générer la berceuse IA</button>
      </div>
      <div id="resultBerceuse" style="margin-top:1.5em"></div>
      <button onclick="menu('')">⬅️ Retour</button>
    `;
  }
  else if (type === "jeu") {
    html = `
      <div class="formzone">
        <h2>Jeu ou Devinette IA</h2>
        <label>Indique le type (ex : jeu de calcul, devinette animaux…)</label><br>
        <input id="cibleJeu" style="width:85%;margin:10px 0" placeholder="ex: Devinette rigolote pour enfant" /><br>
        <button data-gen="1" onclick="genererTexteIA('jeu')">Lancer le jeu IA</button>
      </div>
      <div id="resultJeu" style="margin-top:1.5em"></div>
      <button onclick="menu('')">⬅️ Retour</button>
    `;
  }
  else if (type === "blague") {
    html = `
      <div class="formzone">
        <h2>Blague IA sur-mesure</h2>
        <label>Public, sujet ou style ?</label><br>
        <input id="cibleBlague" style="width:85%;margin:10px 0" placeholder="ex: Blague pour groupe d’amis sur les pizzas" /><br>
        <button data-gen="1" onclick="genererTexteIA('blague')">Générer la blague IA</button>
      </div>
      <div id="resultBlague" style="margin-top:1.5em"></div>
      <button onclick="menu('')">⬅️ Retour</button>
    `;
  }
  document.getElementById('zone').innerHTML = html;
}

// MODE DEMO : tu ajoutes ici les IA et packs plus tard
function genererTexteIA(type) {
  let cible = "";
  let idResult = "";
  let prompt = "";
  if (type === "histoire") {
    cible = document.getElementById("cibleHistoire").value;
    idResult = "resultHistoire";
    prompt = `Écris une histoire originale, immersive et joyeuse pour un enfant selon sa description (prénom, âge, thème, envies). Adapte vraiment le texte à la demande, sois inventif et naturel.`;
  } else if (type === "berceuse") {
    cible = document.getElementById("cibleBerceuse").value;
    idResult = "resultBerceuse";
    prompt = `Invente une berceuse douce et personnalisée, adaptée à la description. Le prénom doit être utilisé, l’ambiance (sons, style, humeur) adaptée à la demande.`;
  } else if (type === "jeu") {
    cible = document.getElementById("cibleJeu").value;
    idResult = "resultJeu";
    prompt = `Lance un jeu ou une devinette originale pour un enfant selon la description (ex: devinette animaux, jeu logique, etc). Sois amusant et pédagogique.`;
  } else if (type === "blague") {
    cible = document.getElementById("cibleBlague").value;
    idResult = "resultBlague";
    prompt = `Crée une blague vraiment drôle et adaptée au public ou au sujet donné. Ne répète pas le sujet, personnalise le ton.`;
  }
  if (!cible) {
    alert("Merci de remplir la demande personnalisée !");
    return;
  }
  document.getElementById(idResult).innerHTML = "⏳ L’IA génère le texte en direct…";
  setTimeout(() => {
    // MODE DEMO : Remplace ça par une vraie requête IA plus tard !
    let fake = "";
    if (type === "histoire") fake = `Il était une fois ${cible.split(",")[0]}, qui vivait une aventure magique dans un monde de dragons et d’étoiles.`;
    else if (type === "berceuse") fake = `Dors paisiblement, ${cible.split(",")[0]}, la nuit veille sur toi, tout ira bien.`;
    else if (type === "jeu") fake = `Devine : Qui suis-je ? J’ai des oreilles longues et je saute partout…`;
    else if (type === "blague") fake = `Pourquoi le mouton n’utilise jamais Internet ? Parce qu’il a peur du cloud !`;
    document.getElementById(idResult).innerHTML = "<b>Résultat IA :</b><br><br>" + fake;
    if (modeVocal) parlerTexte(fake);
  }, 1200);
}

window.onload = accueilChoixMode;
</script>
</body>
</html>
